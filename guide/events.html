<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Event Scripting | TwilioQuest Extensions</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.twilio.com/quest/next/favicon.png">
    <meta name="description" content="Get started building new adventures in TwilioQuest.">
    <meta name="theme-color" content="#F22F46">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/extension-docs/assets/css/0.styles.a221b2e8.css" as="style"><link rel="preload" href="/extension-docs/assets/js/app.6fa20bf3.js" as="script"><link rel="preload" href="/extension-docs/assets/js/2.fd243e3f.js" as="script"><link rel="preload" href="/extension-docs/assets/js/15.892ac1c6.js" as="script"><link rel="preload" href="/extension-docs/assets/js/24.5b6b82a7.js" as="script"><link rel="prefetch" href="/extension-docs/assets/js/10.c274ca5a.js"><link rel="prefetch" href="/extension-docs/assets/js/11.684115fc.js"><link rel="prefetch" href="/extension-docs/assets/js/12.4f5ddf23.js"><link rel="prefetch" href="/extension-docs/assets/js/13.61603454.js"><link rel="prefetch" href="/extension-docs/assets/js/14.61dc16af.js"><link rel="prefetch" href="/extension-docs/assets/js/16.2f2b8759.js"><link rel="prefetch" href="/extension-docs/assets/js/17.167d7af2.js"><link rel="prefetch" href="/extension-docs/assets/js/18.15844322.js"><link rel="prefetch" href="/extension-docs/assets/js/19.52927ccf.js"><link rel="prefetch" href="/extension-docs/assets/js/20.1563e2e0.js"><link rel="prefetch" href="/extension-docs/assets/js/21.4e03b6a7.js"><link rel="prefetch" href="/extension-docs/assets/js/22.cedc8013.js"><link rel="prefetch" href="/extension-docs/assets/js/23.143a33e3.js"><link rel="prefetch" href="/extension-docs/assets/js/25.8bf8c99e.js"><link rel="prefetch" href="/extension-docs/assets/js/26.bc58dd07.js"><link rel="prefetch" href="/extension-docs/assets/js/27.df97af14.js"><link rel="prefetch" href="/extension-docs/assets/js/3.b68eb8d3.js"><link rel="prefetch" href="/extension-docs/assets/js/4.9c3d6252.js"><link rel="prefetch" href="/extension-docs/assets/js/5.0673701e.js"><link rel="prefetch" href="/extension-docs/assets/js/6.f1c75625.js"><link rel="prefetch" href="/extension-docs/assets/js/7.0ede63ba.js"><link rel="prefetch" href="/extension-docs/assets/js/8.ea3664ab.js"><link rel="prefetch" href="/extension-docs/assets/js/9.42b36313.js">
    <link rel="stylesheet" href="/extension-docs/assets/css/0.styles.a221b2e8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/extension-docs/" class="home-link router-link-active"><!----> <span class="site-name">TwilioQuest Extensions</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/extension-docs/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/extension-docs/api/" class="nav-link">
  API Reference
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/extension-docs/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/extension-docs/api/" class="nav-link">
  API Reference
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/extension-docs/guide/" aria-current="page" class="sidebar-link">Getting Started</a></li><li><a href="/extension-docs/guide/architecture.html" class="sidebar-link">Architecture Overview</a></li><li><a href="/extension-docs/guide/levels.html" class="sidebar-link">Creating New Levels</a></li><li><a href="/extension-docs/guide/maps.html" class="sidebar-link">Editing Maps</a></li><li><a href="/extension-docs/guide/objectives.html" class="sidebar-link">Creating Objectives</a></li><li><a href="/extension-docs/guide/npcs.html" class="sidebar-link">Non Player Characters</a></li><li><a href="/extension-docs/guide/events.html" aria-current="page" class="active sidebar-link">Event Scripting</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/extension-docs/guide/events.html#maybe-objects-are-better-for-you" class="sidebar-link">Maybe objects are better for you?</a></li><li class="sidebar-sub-header"><a href="/extension-docs/guide/events.html#what-is-events-js" class="sidebar-link">What is events.js?</a></li><li class="sidebar-sub-header"><a href="/extension-docs/guide/events.html#good-practices-for-structuring-event-js-files" class="sidebar-link">Good practices for structuring event.js files</a></li></ul></li><li><a href="/extension-docs/guide/custom_objects.html" class="sidebar-link">Creating Custom Objects</a></li><li><a href="/extension-docs/guide/distribution.html" class="sidebar-link">Distributing Your Extension</a></li></ul></section></li></ul> </aside> <main sidebar-items="[object Object]" class="page"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css"> <a target="_blank" href="http://github.com/TwilioQuest/extension-docs" data-ribbon="Contribute on GitHub" title="Contribute on GitHub" class="github-fork-ribbon left-bottom fixed">
    Contribute on GitHub
  </a> <div class="theme-default-content content__default"><h1 id="event-scripting"><a href="#event-scripting" class="header-anchor">#</a> Event Scripting</h1> <div class="custom-block warning"><p class="custom-block-title">WIP ⚠️</p> <p>This guide is still a work in progress!</p></div> <p>Event scripting lets map authors add custom dynamic touches to their levels. The event scripting API exposes ways for authors to change the world in response to events that happen while the game is running. The API is powerful and open ended, it lets authors execute any arbitrary JavaScript code they want to accomplish what they need.</p> <h2 id="maybe-objects-are-better-for-you"><a href="#maybe-objects-are-better-for-you" class="header-anchor">#</a> Maybe objects are better for you?</h2> <p>TwilioQuest also supports a robust <a href="/extension-docs/guide/custom_objects.html">Object scripting API</a>. A lot of the scripting needs map authors run into relate to manipulating objects in the world. It's easier to encapsulate custom behavior that relates to a single object or the relationships between a couple objects with the Object Scripting API.</p> <p>Events scripting is broader and can get trickier to manage because it's not encapsulated in any way. This is probably best for global scale level things rather than managing individual objects.</p> <h2 id="what-is-events-js"><a href="#what-is-events-js" class="header-anchor">#</a> What is events.js?</h2> <p>Events scripting starts with the <code>events.js</code> file at the root level of a level as documented in the <a href="/extension-docs/api/events.html">events scripting API</a>. This file is a JavaScript module that exports an event handler. As events happen in TwilioQuest's lifecycle, we'll invoke your event handler. Then your event handler can respond to the events and change the world with the <a href="/extension-docs/api/events.html#world-api">world object API</a>.</p> <p>Here's an empty example of an <code>events.js</code> handler.</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> world</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Here's an event handler that pops up a notification with the map's name when a map loads.</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> world</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;mapDidLoad&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    world<span class="token punctuation">.</span><span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The map &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>mapName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; just loaded!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Check out a list of <a href="/extension-docs/api/events.html#event-object">all the events</a> you can respond to and <a href="/extension-docs/api/events.html#world-api">the world api functions</a> you can use in response.</p> <h2 id="good-practices-for-structuring-event-js-files"><a href="#good-practices-for-structuring-event-js-files" class="header-anchor">#</a> Good practices for structuring event.js files</h2> <p>We've written a lot of events.js files in the past! Here are some of the tips we've found that make these files easier to work with.</p> <h3 id="state-management"><a href="#state-management" class="header-anchor">#</a> State management</h3> <p>One of the things that's easy to forget with event.js files is that you have no guarantee which events have run already in a previous session. Commonly, you'll want to make some change to your level in response to a player event. Maybe you want to hide a wall in response to a <code>playerDidInteract</code> on a special lever object. The first solution to that problem likely looks something like this:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> world</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    event<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;playerDidInteract&quot;</span> <span class="token operator">&amp;&amp;</span>
    event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">&quot;special_lever&quot;</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    world<span class="token punctuation">.</span><span class="token function">hideEntities</span><span class="token punctuation">(</span><span class="token string">&quot;wall&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>This will work great on your first test case! However, if you leave this map and then return you'll see the wall has reappeared! This is because the <code>playerDidInteract</code> event was only triggered initially. Once the map reloads everything is reset to it's initial state. To prevent this we'll need to make use of the world APIs <code>setState</code> and <code>getState</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Create a default state object to persist our information</span>
<span class="token keyword">const</span> <span class="token constant">INITIAL_STATE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  isWallHidden<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Create a unique key for our state to be stored under</span>
<span class="token keyword">const</span> <span class="token constant">WORLD_STATE_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;com.twilioquest.demo&quot;</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> world</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Load our world state</span>
  <span class="token keyword">const</span> worldState <span class="token operator">=</span> world<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token constant">WORLD_STATE_KEY</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token constant">INITIAL_STATE</span><span class="token punctuation">;</span>

  <span class="token comment">// Change world state in response to events</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    event<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;playerDidInteract&quot;</span> <span class="token operator">&amp;&amp;</span>
    event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">&quot;special_lever&quot;</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    worldState<span class="token punctuation">.</span>isWallHidden <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// &quot;Render&quot; our world state after all events process</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>worldState<span class="token punctuation">.</span>isWallHidden<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    world<span class="token punctuation">.</span><span class="token function">hideEntities</span><span class="token punctuation">(</span><span class="token string">&quot;wall&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Persist world state across event handler invocations</span>
  world<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token constant">WORLD_STATE_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>To summarize the above code in a few points for a reference:</p> <ol><li>Create an initial state</li> <li>Get saved world state or fallback to initial state</li> <li>Modify current world state in response to events</li> <li>Affect changes on the world (or render) based on state</li> <li>Persist current world state</li></ol></div></main></div><div class="global-ui"></div></div>
    <script src="/extension-docs/assets/js/app.6fa20bf3.js" defer></script><script src="/extension-docs/assets/js/2.fd243e3f.js" defer></script><script src="/extension-docs/assets/js/15.892ac1c6.js" defer></script><script src="/extension-docs/assets/js/24.5b6b82a7.js" defer></script>
  </body>
</html>
